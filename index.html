<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <title>Gothic 4 - Arcania - Interactive Map</title>
</head>

<body>
  <div id="map"></div>

  <script>
    const map = L.map('map', {
      center: [51.505, -0.09],
      zoom: 2,
      preferCanvas: true,
      zoomControl: false
    });

    new L.Control.Zoom({ position: 'topright' }).addTo(map)

    L.tileLayer('/map/tiles/{z}/{x}/{y}.jpg', {
      minZoom: 1,
      maxZoom: 4,
      noWrap: true,
      attribution: 'Maps from <a href="https://www.worldofgothic.com/">World of Gothic</a> | Markers from <a href="https://www.xboxachievements.com/forum/topic/239955-arcania-gothic-4-collectables-guide/">Xbox Achievements</a> | Made with <a href="https://leafletjs.com">Leaflet</a>'
    }).addTo(map);

    const iconSize = [30, 30]

    const icons = {
      adanos: L.icon({
        iconUrl: './assets/icons/gothic_4/adanos.webp',
        iconSize,
        className: 'adanos-icon'
      }),
      innos: L.icon({
        iconUrl: './assets/icons/gothic_4/innos.webp',
        iconSize,
        className: 'innos-icon'
      }),
      beliar: L.icon({
        iconUrl: './assets/icons/gothic_4/beliar.webp',
        iconSize,
        className: 'beliar-icon'
      })
    }

    const markersGroup = {
      'adanos': {
        icon: icons.adanos,
        markers: [
          {
            index: 0,
            title: "",
            instructions: "",
            coord: [81.133945, -54.140625],
            collected: false,
          },
          {
            index: 1,
            title: "",
            instructions: "",
            coord: [80.088352, -11.425781],
            collected: false,
          },
          {
            index: 2,
            title: "",
            instructions: "",
            coord: [75.75894, -32.607422],
            collected: false,
          },
          {
            index: 3,
            title: "",
            instructions: "",
            coord: [63.626745, -20.917969],
            collected: false,
          },
          {
            index: 4,
            title: "",
            instructions: "",
            coord: [63.937372, -45.527344],
            collected: false,
          },
          {
            index: 5,
            title: "",
            instructions: "",
            coord: [62.552857, -45.439453],
            collected: false,
          },
          {
            index: 6,
            title: "",
            instructions: "",
            coord: [57.797944, -106.611328],
            collected: false,
          },
          {
            index: 7,
            title: "",
            instructions: "",
            coord: [53.435719, -112.324219],
            collected: false,
          },
          {
            index: 8,
            title: "",
            instructions: "",
            coord: [31.877558, -68.554688],
            collected: false,
          },
          {
            index: 9,
            title: "",
            instructions: "",
            coord: [15.36895, -67.412109],
            collected: false,
          },
          {
            index: 10,
            title: "",
            instructions: "",
            coord: [-10.746969, -66.796875],
            collected: false,
          },
          {
            index: 11,
            title: "",
            instructions: "",
            coord: [-23.725012, -56.953125],
            collected: false,
          },
          {
            index: 12,
            title: "",
            instructions: "",
            coord: [-18.229351, -83.144531],
            collected: false,
          },
          {
            index: 13,
            title: "",
            instructions: "",
            coord: [-15.284185, -96.591797],
            collected: false,
          },
          {
            index: 14,
            title: "",
            instructions: "",
            coord: [43.516689, 34.892578],
            collected: false,
          },
          {
            index: 15,
            title: "",
            instructions: "",
            coord: [11.436955, -31.025391],
            collected: false,
          },
          {
            index: 16,
            title: "",
            instructions: "",
            coord: [10.314919, -20.039063],
            collected: false,
          },
          {
            index: 17,
            title: "",
            instructions: "",
            coord: [-37.300275, -13.710938],
            collected: false,
          },
          {
            index: 18,
            title: "",
            instructions: "",
            coord: [-50.513427, -47.285156],
            collected: false,
          },
          {
            index: 19,
            title: "",
            instructions: "",
            coord: [-0.439449, 90.615234],
            collected: false,
          },
          {
            index: 20,
            title: "",
            instructions: "",
            coord: [-14.944785, 66.621094],
            collected: false,
          },
          {
            index: 21,
            title: "",
            instructions: "",
            coord: [-56.848972, 46.669922],
            collected: false,
          },
          {
            index: 22,
            title: "",
            instructions: "",
            coord: [-75.095633, 40.166016],
            collected: false,
          },
          {
            index: 23,
            title: "",
            instructions: "",
            coord: [-79.639874, 45.527344],
            collected: false,
          },
          {
            index: 24,
            title: "",
            instructions: "",
            coord: [-80.532071, 63.984375],
            collected: false,
          },
          {
            index: 25,
            title: "",
            instructions: "",
            coord: [-79.608215, 27.597656],
            collected: false,
          },
          {
            index: 26,
            title: "",
            instructions: "",
            coord: [-78.836065, 6.679688],
            collected: false,
          },
          {
            index: 27,
            title: "",
            instructions: "",
            coord: [-79.671438, -36.738281],
            collected: false,
          },
          {
            index: 28,
            title: "",
            instructions: "",
            coord: [-71.441171, -10.898438],
            collected: false,
          },
          {
            index: 29,
            title: "",
            instructions: "",
            coord: [-64.623877, -8.613281],
            collected: false,
          },
        ]
      },
      'beliar': {
        icon: icons.beliar,
        markers: [
          {
            index: 0,
            title: "",
            instructions: "",
            coord: [81.861208, -69.257813],
            collected: false,
          },
          {
            index: 1,
            title: "",
            instructions: "",
            coord: [79.480618, -19.775391],
            collected: false,
          },
          {
            index: 2,
            title: "",
            instructions: "",
            coord: [70.641769, -46.669922],
            collected: false,
          },
          {
            index: 3,
            title: "",
            instructions: "",
            coord: [67.373698, -13.095703],
            collected: false,
          },
          {
            index: 4,
            title: "",
            instructions: "",
            coord: [59.445075, 7.910156],
            collected: false,
          },
          {
            index: 5,
            title: "",
            instructions: "",
            coord: [56.022948, -22.412109],
            collected: false,
          },
          {
            index: 6,
            title: "",
            instructions: "",
            coord: [57.515823, -107.490234],
            collected: false,
          },
          {
            index: 7,
            title: "",
            instructions: "",
            coord: [55.72711, -105.46875],
            collected: false,
          },
          {
            index: 8,
            title: "",
            instructions: "",
            coord: [46.800059, -88.330078],
            collected: false,
          },
          {
            index: 9,
            title: "",
            instructions: "",
            coord: [44.465151, -78.134766],
            collected: false,
          },
          {
            index: 10,
            title: "",
            instructions: "",
            coord: [32.026706, -94.658203],
            collected: false,
          },
          {
            index: 11,
            title: "",
            instructions: "",
            coord: [21.371244, -73.564453],
            collected: false,
          },
          {
            index: 12,
            title: "",
            instructions: "",
            coord: [12.554564, -78.574219],
            collected: false,
          },
          {
            index: 13,
            title: "",
            instructions: "",
            coord: [15.284185, -96.152344],
            collected: false,
          },
          {
            index: 14,
            title: "",
            instructions: "",
            coord: [-25.562265, -61.523438],
            collected: false,
          },
          {
            index: 15,
            title: "",
            instructions: "",
            coord: [29.152161, -44.736328],
            collected: false,
          },
          {
            index: 16,
            title: "",
            instructions: "",
            coord: [-9.968851, -4.130859],
            collected: false,
          },
          {
            index: 17,
            title: "",
            instructions: "",
            coord: [-49.15297, -43.417969],
            collected: false,
          },
          {
            index: 18,
            title: "",
            instructions: "",
            coord: [34.524661, 49.130859],
            collected: false,
          },
          {
            index: 19,
            title: "",
            instructions: "",
            coord: [16.045813, 52.822266],
            collected: false,
          },
          {
            index: 20,
            title: "",
            instructions: "",
            coord: [4.039618, 67.5],
            collected: false,
          },
          {
            index: 21,
            title: "",
            instructions: "",
            coord: [-41.967659, 75.9375],
            collected: false,
          },
          {
            index: 22,
            title: "",
            instructions: "",
            coord: [-47.635784, 51.679688],
            collected: false,
          },
          {
            index: 23,
            title: "",
            instructions: "",
            coord: [-51.672555, 43.769531],
            collected: false,
          },
          {
            index: 24,
            title: "",
            instructions: "",
            coord: [-61.897578, 27.246094],
            collected: false,
          },
          {
            index: 25,
            title: "",
            instructions: "",
            coord: [-79.57646, 58.974609],
            collected: false,
          },
          {
            index: 26,
            title: "",
            instructions: "",
            coord: [-80.312728, 68.115234],
            collected: false,
          },
          {
            index: 27,
            title: "",
            instructions: "",
            coord: [-80.900669, 18.632813],
            collected: false,
          },
          {
            index: 28,
            title: "",
            instructions: "",
            coord: [-64.661517, -4.482422],
            collected: false,
          },
          {
            index: 29,
            title: "",
            instructions: "",
            coord: [-70.110485, -17.929688],
            collected: false,
          },
        ]
      },
      'innos': {
        icon: icons.innos,
        markers: [
          {
            index: 0,
            title: "Cleaved Maiden Inno's Statues",
            instructions: "At the side of the barn next to Murdra's tavern",
            coord: [10.660608, -75.234375],
            collected: false,
          },
          {
            index: 1,
            title: "Cleaved Maiden Inno's Statues",
            instructions: "Inside the Southern mine behind some crates",
            coord: [10.401378, -79.189453],
            collected: false,
          },
          {
            index: 2,
            title: "South Stewark Inno's Statues",
            instructions: "Upstairs in Ogtar's house, the statue is cunningly hidden inbetween the 3 barrels. This can be awkward to pick up but I managed to get it by climbing on the bed on the left and looking down at it.",
            coord: [55.875311, -73.037109],
            collected: false,
          },
          {
            index: 3,
            title: "South Stewark Inno's Statues",
            instructions: "Inside the Citadel in Stewark",
            coord: [54.316523, -109.335938],
            collected: false,
          },
          {
            index: 4,
            title: "South Stewark Inno's Statues",
            instructions: "Stand in front of the Citadel in Stewark then look to your left. You should see a wooden staircase going up. Climb the staircase and enter the house. You should see several lectern's on the first floor. Go up the next set of stairs to see some bookshelves. There is a Shaman's Bracer's plans on the table and the statue is on the bookshelf behind it.",
            coord: [52.214339, -108.720703],
            collected: false,
          },
          {
            index: 5,
            title: "Valley of Blood Inno's Statues",
            instructions: "Go to the logging camp just north of the Ranger's Camp. On the map, just a little to the north west are some rocks with a wooden awning at the bottom of them. The statue is hidden behind the barrels.",
            coord: [54.213861, -42.275391],
            collected: false,
          },
          {
            index: 6,
            title: "",
            instructions: "",
            coord: [83.277705, -37.001953],
            collected: false,
          },
          {
            index: 7,
            title: "",
            instructions: "",
            coord: [82.118384, -44.121094],
            collected: false,
          },
          {
            index: 8,
            title: "",
            instructions: "",
            coord: [80.208652, -58.359375],
            collected: false,
          },
          {
            index: 9,
            title: "",
            instructions: "",
            coord: [77.823323, -26.630859],
            collected: false,
          },
          {
            index: 10,
            title: "",
            instructions: "",
            coord: [77.860345, -31.113281],
            collected: false,
          },
          {
            index: 11,
            title: "",
            instructions: "",
            coord: [68.752315, -50.888672],
            collected: false,
          },
          {
            index: 12,
            title: "",
            instructions: "",
            coord: [61.606396, -15.644531],
            collected: false,
          },
          {
            index: 13,
            title: "",
            instructions: "",
            coord: [-20.797201, -66.621094],
            collected: false,
          },
          {
            index: 14,
            title: "",
            instructions: "",
            coord: [14.85985, -26.367188],
            collected: false,
          },
          {
            index: 15,
            title: "",
            instructions: "",
            coord: [18.145852, -20.654297],
            collected: false,
          },
          {
            index: 16,
            title: "",
            instructions: "",
            coord: [12.039321, 63.632813],
            collected: false,
          },
          {
            index: 17,
            title: "",
            instructions: "",
            coord: [-7.885147, 81.474609],
            collected: false,
          },
          {
            index: 18,
            title: "",
            instructions: "",
            coord: [-14.43468, 56.601563],
            collected: false,
          },
          {
            index: 19,
            title: "",
            instructions: "",
            coord: [-54.572062, 42.978516],
            collected: false,
          },
          {
            index: 20,
            title: "",
            instructions: "",
            coord: [-69.990535, 36.298828],
            collected: false,
          },
          {
            index: 21,
            title: "",
            instructions: "",
            coord: [-80.327506, 66.09375],
            collected: false,
          },
          {
            index: 22,
            title: "",
            instructions: "",
            coord: [-73.77578, -16.611328],
            collected: false,
          },
          {
            index: 23,
            title: "",
            instructions: "",
            coord: [-72.86793, -14.765625],
            collected: false,
          },
          {
            index: 24,
            title: "",
            instructions: "",
            coord: [-71.469124, -22.939453],
            collected: false,
          },
          {
            index: 25,
            title: "",
            instructions: "",
            coord: [-5.178482, -7.910156],
            collected: false,
          },
          {
            index: 26,
            title: "",
            instructions: "",
            coord: [-14.349548, -25.576172],
            collected: false,
          },
          {
            index: 27,
            title: "",
            instructions: "",
            coord: [-47.576526, -28.916016],
            collected: false,
          },
          {
            index: 28,
            title: "",
            instructions: "",
            coord: [-70.229744, -17.138672],
            collected: false,
          },
          {
            index: 29,
            title: "",
            instructions: "",
            coord: [-68.847665, -12.392578],
            collected: false,
          },
        ]
      }
    }

    addMarkers(markersGroup);

    var markerTarget = null;

    function toggleCollected(type, index) {
      if (!markerTarget) {
        console.error('No marker target');
        return;
      }

      const markerToToggle = markersGroup[type].markers[index];
      markerToToggle.collected = !markerToToggle.collected;

      if (markerToToggle.collected) {
        markerTarget.classList.add('icon-collected');
      } else {
        markerTarget.classList.remove('icon-collected')
      }
    }

    function addMarkers(markersGroup) {
      Object.keys(markersGroup).forEach(key => {
        const currentMarkerGroup = markersGroup[key]

        currentMarkerGroup.markers.forEach((mark, index) => {
          const marker = L.marker(mark.coord, {
            icon: currentMarkerGroup.icon,
            title: `${mark.index + 1} - ${mark.title}`,
            alt: `${mark.index + 1} - ${mark.title}`,
            index: mark.index,
            type: key,

            riseOnHover: true,
            interactive: true,
          }).addTo(map)


          marker.on('click', (e) => {
            const popup = L.popup();

            markerTarget = e.originalEvent.target;

            const targetMarkerOptions = e.target.options;
            const targetType = targetMarkerOptions.type;
            const targetIndex = targetMarkerOptions.index;

            const content = `
              <div class="instructions">${mark.instructions}</div>
              <hr class="divider" />
              <label role="button" class="collectedButton">
                <input 
                  type="checkbox" id="collectedInput"
                  ${markersGroup[targetType].markers[targetIndex].collected ? 'checked' : ''} 
                  oninput="toggleCollected('${targetType}', '${targetIndex}')"
                />
                Collected
              </label>
            `.trim();

            popup
              .setLatLng(e.latlng)
              .setContent(content)
              .openOn(map);

            popup.on('remove', () => {
              markerTarget = null;
            })
          })

          /* marker.on('click', (e) => {
            const popup = L.popup();
  
            popup
              .setLatLng(e.latlng)
              .setContent(e.latlng.toString())
              .openOn(map);
          }) */
        })
      })

    }
  </script>

  <style>
    body,
    html {
      margin: 0;
    }

    #map {
      height: 100vh;
      background: black;
    }

    a[title="A JavaScript library for interactive maps"],
    a[title="A JavaScript library for interactive maps"]~span {
      display: none;
    }

    .leaflet-popup-content {
      margin: 0
    }

    .leaflet-popup-content .instructions {
      margin: 13px 24px 13px 20px;
    }

    .leaflet-popup-content hr {
      margin-bottom: 0;
    }

    .leaflet-popup-content .collectedButton {
      display: block;
      width: 100%;
      background: transparent;
      border: 0;
      cursor: pointer;
      padding: 10px 0;
      text-align: center;
      text-transform: uppercase;
    }

    .icon-collected {
      opacity: 0.3;
    }
  </style>
</body>

</html>